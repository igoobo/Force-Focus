# ----------------------------------------------------
# docker-compose.yml (Force-Focus 프로젝트 최상위 폴더 - MongoDB 기반)

version: '3.8'

services:
  # --- backend 서비스 정의 ---
  backend:
    build: ./backend
    container_name: force-focus-backend
    ports:
      - "8000:8000"
    volumes:
      - ./backend:/app
    env_file:
      - .env
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
    # (추가) backend 서비스가 mongodb 서비스가 시작된 후에 실행되도록 의존성을 설정합니다.
    depends_on:
      - mongodb

  # --- (추가) mongodb 서비스 정의 ---
  mongodb:
    image: mongo:latest # Docker Hub에서 최신 MongoDB 공식 이미지를 사용합니다.
    container_name: force-focus-mongodb
    ports:
      - "27017:27017" # 로컬 PC의 27017 포트를 컨테이너의 27017 포트와 연결합니다.
    environment:
      # .env 파일에서 MongoDB 초기 설정을 위한 루트 사용자 이름과 비밀번호를 가져옵니다.
      MONGO_INITDB_ROOT_USERNAME: ${MONGO_INITDB_ROOT_USERNAME}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_INITDB_ROOT_PASSWORD}
    volumes:
      # 'mongodb_data'라는 이름의 볼륨을 사용하여 데이터베이스 데이터를 영속적으로 저장합니다.
      # 이렇게 하면 컨테이너를 삭제하고 다시 만들어도 데이터가 유지됩니다.
      - mongodb_data:/data/db

# (추가) 데이터 영속성을 위한 볼륨을 정의합니다.
volumes:
  mongodb_data: